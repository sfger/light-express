<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><title>Title333</title><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, minimal-ui" /><meta name="apple-mobile-web-app-capable" content="yes" /><meta name="apple-mobile-web-app-status-bar-style" content="black" /><meta name="format-detection" content="telephone=no" /><meta name="author" content="" /><meta name="revisit-after" content="1 days" /><meta name="keywords" content="" /><meta name="description" content="" /><link rel="stylesheet" type="text/css" href="../../../../public/css/base.css?__version__" /><link rel="stylesheet" type="text/css" href="../../../../ui/css/reload.css?__version__" /></head><body><div class="page"><header class="header"><a class="action-left arrow-left" href=""></a><span>test</span><a class="action-right" href="">测试</a></header><section class="wrapper"><div class="scroller"><label><input class="checkbox" type="checkbox"><span class="label">点击选择</span></label><ul><li>000000000000000000000000000000</li><li>111111111111111111111111111111</li><li>222222222222222222222222222222</li><li>333333333333333333333333333333</li><li>444444444444444444444444444444</li><li>555555555555555555555555555555</li><li>666666666666666666666666666666</li><li>777777777777777777777777777777</li><li>888888888888888888888888888888</li><li>999999999999999999999999999999</li><li>101010101010101010101010101010101010101010101010101010101010</li><li>111111111111111111111111111111111111111111111111111111111111</li><li>121212121212121212121212121212121212121212121212121212121212</li><li>131313131313131313131313131313131313131313131313131313131313</li><li>141414141414141414141414141414141414141414141414141414141414</li><li>151515151515151515151515151515151515151515151515151515151515</li><li>161616161616161616161616161616161616161616161616161616161616</li><li>171717171717171717171717171717171717171717171717171717171717</li><li>181818181818181818181818181818181818181818181818181818181818</li><li>191919191919191919191919191919191919191919191919191919191919</li><li>202020202020202020202020202020202020202020202020202020202020</li><li>212121212121212121212121212121212121212121212121212121212121</li><li>222222222222222222222222222222222222222222222222222222222222</li><li>232323232323232323232323232323232323232323232323232323232323</li><li>242424242424242424242424242424242424242424242424242424242424</li><li>252525252525252525252525252525252525252525252525252525252525</li><li>262626262626262626262626262626262626262626262626262626262626</li><li>272727272727272727272727272727272727272727272727272727272727</li><li>282828282828282828282828282828282828282828282828282828282828</li><li>292929292929292929292929292929292929292929292929292929292929</li><li>303030303030303030303030303030303030303030303030303030303030</li><li>313131313131313131313131313131313131313131313131313131313131</li><li>323232323232323232323232323232323232323232323232323232323232</li><li>333333333333333333333333333333333333333333333333333333333333</li><li>343434343434343434343434343434343434343434343434343434343434</li><li>353535353535353535353535353535353535353535353535353535353535</li><li>363636363636363636363636363636363636363636363636363636363636</li><li>373737373737373737373737373737373737373737373737373737373737</li><li>383838383838383838383838383838383838383838383838383838383838</li><li>393939393939393939393939393939393939393939393939393939393939</li><li>404040404040404040404040404040404040404040404040404040404040</li><li>414141414141414141414141414141414141414141414141414141414141</li><li>424242424242424242424242424242424242424242424242424242424242</li><li>434343434343434343434343434343434343434343434343434343434343</li><li>444444444444444444444444444444444444444444444444444444444444</li><li>454545454545454545454545454545454545454545454545454545454545</li><li>464646464646464646464646464646464646464646464646464646464646</li><li>474747474747474747474747474747474747474747474747474747474747</li><li>484848484848484848484848484848484848484848484848484848484848</li><li>494949494949494949494949494949494949494949494949494949494949</li><li>505050505050505050505050505050505050505050505050505050505050</li><li>515151515151515151515151515151515151515151515151515151515151</li><li>525252525252525252525252525252525252525252525252525252525252</li><li>535353535353535353535353535353535353535353535353535353535353</li><li>545454545454545454545454545454545454545454545454545454545454</li><li>555555555555555555555555555555555555555555555555555555555555</li><li>565656565656565656565656565656565656565656565656565656565656</li><li>575757575757575757575757575757575757575757575757575757575757</li><li>585858585858585858585858585858585858585858585858585858585858</li><li>595959595959595959595959595959595959595959595959595959595959</li><li>606060606060606060606060606060606060606060606060606060606060</li><li>616161616161616161616161616161616161616161616161616161616161</li><li>626262626262626262626262626262626262626262626262626262626262</li><li>636363636363636363636363636363636363636363636363636363636363</li><li>646464646464646464646464646464646464646464646464646464646464</li><li>656565656565656565656565656565656565656565656565656565656565</li><li>666666666666666666666666666666666666666666666666666666666666</li><li>676767676767676767676767676767676767676767676767676767676767</li><li>686868686868686868686868686868686868686868686868686868686868</li><li>696969696969696969696969696969696969696969696969696969696969</li><li>707070707070707070707070707070707070707070707070707070707070</li><li>717171717171717171717171717171717171717171717171717171717171</li><li>727272727272727272727272727272727272727272727272727272727272</li><li>737373737373737373737373737373737373737373737373737373737373</li><li>747474747474747474747474747474747474747474747474747474747474</li><li>757575757575757575757575757575757575757575757575757575757575</li><li>767676767676767676767676767676767676767676767676767676767676</li><li>777777777777777777777777777777777777777777777777777777777777</li><li>787878787878787878787878787878787878787878787878787878787878</li><li>797979797979797979797979797979797979797979797979797979797979</li><li>808080808080808080808080808080808080808080808080808080808080</li><li>818181818181818181818181818181818181818181818181818181818181</li><li>828282828282828282828282828282828282828282828282828282828282</li><li>838383838383838383838383838383838383838383838383838383838383</li><li>848484848484848484848484848484848484848484848484848484848484</li><li>858585858585858585858585858585858585858585858585858585858585</li><li>868686868686868686868686868686868686868686868686868686868686</li><li>878787878787878787878787878787878787878787878787878787878787</li><li>888888888888888888888888888888888888888888888888888888888888</li><li>898989898989898989898989898989898989898989898989898989898989</li><li>909090909090909090909090909090909090909090909090909090909090</li><li>919191919191919191919191919191919191919191919191919191919191</li><li>929292929292929292929292929292929292929292929292929292929292</li><li>939393939393939393939393939393939393939393939393939393939393</li><li>949494949494949494949494949494949494949494949494949494949494</li><li>959595959595959595959595959595959595959595959595959595959595</li><li>969696969696969696969696969696969696969696969696969696969696</li><li>979797979797979797979797979797979797979797979797979797979797</li><li>989898989898989898989898989898989898989898989898989898989898</li><li>999999999999999999999999999999999999999999999999999999999999</li></ul></div></section><footer class="footer btn-group"><span class="btn-cancel">Cancel</span><span class="btn-submit">Ok</span></footer></div><script id="requirejs" data-version="__version__" src="../../../../public/js/require.js?__version__"></script><script>// requestAnimationFrame {{{
(function() {
'use strict';
var vendors = ['webkit', 'moz'];
for (var i = 0; i< vendors.length && !window.requestAnimationFrame; ++i) {
var vp = vendors[i];
window.requestAnimationFrame = window[vp+'RequestAnimationFrame'];
window.cancelAnimationFrame = (window[vp+'CancelAnimationFrame']
|| window[vp+'CancelRequestAnimationFrame']);
}
if (/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent) // iOS6 is buggy
|| !window.requestAnimationFrame || !window.cancelAnimationFrame) {
var lastTime = 0;
window.requestAnimationFrame = function(callback) {
var now = Date.now();
var nextTime = Math.max(lastTime + 16, now);
return setTimeout(function() { callback(lastTime = nextTime); }, nextTime - now);
};
window.cancelAnimationFrame = clearTimeout;
}
}());
// }}}
require.config({
baseUrl:'../../../../',
urlArgs:document.getElementById("requirejs").getAttribute("data-version"),
map:{"*":{css:"require-css"}},
paths:{
jquery:'public/js/jquery',
IScroll:'public/js/iscroll-probe'
},
shim:{
}
});
require(['jquery', 'IScroll'],function($, IScroll){
/* window.onresize = function(){ */
/* 	document.documentElement.style.fontSize = window.innerWidth/3.75/(window.devicePixelRatio||1)+'px!important'; */
/* }; */
/* return false; */
document.documentElement.addEventListener('touchmove', function(e){ e.preventDefault(); }, {passive:false});
document.querySelector('.wrapper').addEventListener('touchend', function(){//{{{
if(is_loading_more(myScroll)){
myScroll.maxScrollY -= loading_limit;
$loadMore.removeClass('state-preloading').addClass('state-loading');
setTimeout(function(data){
var r = Math.random();
if(r>0.5){
recover_loading_stage(myScroll);
}else{
recover_loading_stage(myScroll, recover_time);
return $loadMore.addClass('state-done');
}
}, 1200);
}
}, false);//}}}
function init_iscroll(selector){
return new IScroll(selector, {
/* scrollbars: 'custom', */
top: true,
probeType: 3,
mouseWheel: true,
scrollbars: true,
fadeScrollbars: true,
deceleration: 0.0025,
interactiveScrollbars: true,
shrinkScrollbars: 'scale',
preventDefaultException: {
tagName:/^(INPUT|TEXTAREA|SELECT|LABEL|A|IMG)$/,
className:/(^|\s)(label|clickable)(\s|$)/
}
});
}
window.myScroll = init_iscroll('.wrapper');
console.log(myScroll);
var $scroller = $(myScroll.wrapper.children[0]);
var $loadMore = $('<div class="load-more"><span class="icon-loading"></span></div>');
$scroller.append($loadMore)
var loading_limit = 50;
var recover_time = 200;
myScroll.on('scroll', function(){//{{{
var that = this;
var scroll_timer = this._scroll_timer;
if(scroll_timer){
cancelAnimationFrame(scroll_timer);
scroll_timer = null;
}
scroll_timer = requestAnimationFrame(function(){
var more = is_loading_more(myScroll);
$loadMore[more?'addClass':'removeClass']('state-preloading');
});
});//}}}
myScroll.on('scrollEnd', function(){
$loadMore.removeClass('state-preloading state-loading state-done');
})
function get_over_scroll_height(isr){ return -isr.y+isr.wrapperHeight-isr.scrollerHeight; }
function is_loading_more(isr){ return get_over_scroll_height(isr)>=loading_limit/* && isr.directionY===1;*/ }
function refresh_page(iscroll){/*{{{*/
var refresh_timer = iscroll._refresh_timer;
refresh_timer && cancelAnimationFrame(refresh_timer);
iscroll._refresh_timer = requestAnimationFrame(function(){
iscroll.refresh();
});
}/*}}}*/
function recover_loading_stage(iscroll, late){//{{{
late = late || 0;
setTimeout(function(){
console.log('s');
iscroll.maxScrollY += loading_limit;
iscroll.resetPosition(recover_time);
$loadMore.removeClass('state-preloading state-loading state-done');
}, late);
/* setTimeout(function(){ */
/* 	refresh_page(iscroll); */
/* }, recover_time); */
}//}}}
});</script></body></html>